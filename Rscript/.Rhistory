yearData
code
yData<-yearData[종목코드==code]
yearData[종목코드==code]
yearData['종목코드'==code]
yearData[종목코드==code]
yearData
yearData$종목코드
yearData[종목코드=='005930']
yearData[종목코드=='005930',]
yearData[,종목코드]
yearData[,'종목코드']
yearData[get(종목코드)==code]
yearData[1==code]
yearData[get("종목코드")==code]
yearData
setDT(yearData)
yearData[종목코드==code]
setDT(quarterData)
yData<-yearData[종목코드==code]
qData<-quarterData[종목코드==code]
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
monthCrit
monthTerm
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
yDate
qDate
fsQ
lastYearDate<-businessDate %m+% months(-12)
yData<-yData[yDate>=lastYearDate]
qData<-qData[qDate>=lastYearDate]
yDate<-yDate[yDate>=lastYearDate]
qDate<-qDate[qDate>=lastYearDate]
yData
qData
yDate
qDate
corpTABLE
corpTable
corpTable[1,1]
corpTable[1,]
corpTable[1,][[1]]
fsY$등록일자<-NULL
fsY
fsY[,등록일자:=NULL]
fsY[,등록일자:=1]
fsY
fsQ[,등록일자:=1]
fsQ
yData<-fsY[종목코드==code]
qData<-fsQ[종목코드==code]
yData
qData
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
yDate
qDate
yData$등록일자<-yDate
yData
fsY
unique(fsY$등록일자)
qDate
yData<-fsY[종목코드==code]
qData<-fsQ[종목코드==code]
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
yDate
yData$일자
yDate<-as.Date(paste0(yData$일자,'.01')-1,format='%Y.%m.%d')
as.Date(paste0(yData$일자,'.01')-1
)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')-1
yDate
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')-1
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')-1
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
yDate
qDate
as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')-1
>>>>>>> 2f9028dea9ca8e7a59708c72362670b782dd80c0
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
<<<<<<< HEAD
lastYearDate<-businessDate %m+% months(-12)
yData<-yData[yDate>=lastYearDate]
library(lubridate)
=======
yDate
qDate
yDate-1
fsY[종목코드==code]$등록일자<-yDate-1
fsQ[종목코드==code]$등록일자<-qDate-1
fsY
fsY$등록일자
unique(fsY$등록일자)
fsY$등록일자<-Sys.Date()
fsY
fsY$등록일자<-as.character(Sys.Date())
fsY$등록일자<-as.character(Sys.Date(),format='%Y-%m-%d')
fsY<-subset(fsY,select=-등록일자)
fsY
fsY[,등록일자:=Sys.Date()]
fsY
fsY[종목코드==code]$등록일자<-yDate-1
unique(fsY$등록일자)
?as_date
as.Date("2000-01-01",format="%Y-%m-%d")
fsY[,등록일자:=as.Date("2000-01-01",format="%Y-%m-%d")]
fsQ[,등록일자:=as.Date("2000-01-01",format="%Y-%m-%d")]
fsY
fsQ
fsQ<-subset(fsQ,select=-등록일자)
fsQ
fsQ[,등록일자:=as.Date("2000-01-01",format="%Y-%m-%d")]
fsQ
for(i in 1:nrow(corpTable)){
businessDate<-as.Date(corpTable[i,][[1]],format='%Y-%m-%d'))
code<-corpTable[i,][[2]]
yData<-fsY[종목코드==code]
qData<-fsQ[종목코드==code]
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
>>>>>>> 2f9028dea9ca8e7a59708c72362670b782dd80c0
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
<<<<<<< HEAD
lastYearDate<-businessDate %m+% months(-12)
yData<-yData[yDate>=lastYearDate]
qData<-qData[qDate>=lastYearDate]
yDate<-yDate[yDate>=lastYearDate]
qDate<-qDate[qDate>=lastYearDate]
yData
qDat
qData
yDate<-yData$일자
qDate<-qData$일자
qRank<-frank(-as.double(qDate),ties.method="dense")
yRank<-frank(-as.double(yDate),ties.method="dense")
if(length(yRank) == 0 & length(unique(qRank)) < 4 ){return(result)}
curQRange<-diff(range(as.double(qDate)[qRank<5]))
data
if(length(unique(qDate))>=4 & curQRange<=1){
data<-qData[qRank<=4]
} else{ data<-yData[yRank==1] }
data
corpTable
corpData<-corpTable[종목코드=='005930']
corpData
corpData<-corpData[37]
corpData
yearData
businessDate<-as.Date(corpData[[1]],format='%Y-%m-%d')
code<-corpData[[2]]
yData<-yearData[종목코드==code]
qData<-quarterData[종목코드==code]
=======
fsY[종목코드==code]$등록일자<-yDate-1
fsQ[종목코드==code]$등록일자<-qDate-1
}
for(i in 1:nrow(corpTable)){
businessDate<-as.Date(corpTable[i,][[1]],format='%Y-%m-%d')
code<-corpTable[i,][[2]]
yData<-fsY[종목코드==code]
qData<-fsQ[종목코드==code]
>>>>>>> 2f9028dea9ca8e7a59708c72362670b782dd80c0
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
monthCrit<-month(yDate[1])
monthTerm<-rep(3,12)
monthTerm[monthCrit]<-4
month(yDate)<-month(yDate)+4
month(qDate)<-month(qDate)+monthTerm[month(qDate)]
<<<<<<< HEAD
lastYearDate<-businessDate %m+% months(-12)
yData<-yData[yDate>=lastYearDate]
qData<-qData[qDate>=lastYearDate]
yDate<-yDate[yDate>=lastYearDate]
qDate<-qDate[qDate>=lastYearDate]
if(!isNew){
yData<-yData[yDate<=businessDate]
qData<-qData[qDate<=businessDate]
}
yDate<-yData$일자
qDate<-qData$일자
qRank<-frank(-as.double(qDate),ties.method="dense")
yRank<-frank(-as.double(yDate),ties.method="dense")
if(length(yRank) == 0 & length(unique(qRank)) < 4 ){return(result)}
curQRange<-diff(range(as.double(qDate)[qRank<5]))
if(length(unique(qDate))>=4 & curQRange<=1){
data<-qData[qRank<=4]
} else{ data<-yData[yRank==1] }
data
data
data<-sumQuarterData(data)
sumQuarterData<-function(data){
fs<-data[data$종류=='재무상태표']
data<-data[data$종류!='재무상태표']
fs<-fs[fs$일자==max(fs$일자)]
fs<-fs[,-'일자']
if(length(unique(data$일자))>1) data<-data[,.(값=sum(값)),by=c('종목코드','종류','계정')] else{
data<-data[,-'일자']
}
names(fs)<-names(data)
data<-rbind(data,fs)
return(data)
}
data<-sumQuarterData(data)
data
fs<-data[data$종류=='재무상태표']
data<-data[data$종류!='재무상태표']
fs<-fs[fs$일자==max(fs$일자)]
fs<-fs[,-'일자']
if(length(unique(data$일자))>1) data<-data[,.(값=sum(값)),by=c('종목코드','종류','계정')] else{
data<-data[,-'일자']
}
fs
data
data[,.(값=sum(값)),by=c('종목코드','종류','계정')]
data[,.(값=sum('값')),by=c('종목코드','종류','계정')]
data[,.('값'=sum('값')),by=c('종목코드','종류','계정')]
data[,sum(값)),by=c('종목코드','종류','계정')]
data[,sum(값),by=c('종목코드','종류','계정')]
data[,sum(값)]
data[,sum(값),by=c('종목코드','종류','계정')]
data[,sum(값),by=list('종목코드','종류','계정')]
data[,sum(.SD),by=c('종목코드','종류','계정'),.SDcols=5]
data[,.(값=sum(.SD)),by=c('종목코드','종류','계정'),.SDcols=5]
data
data<-data[,.(값=sum(.SD)),by=c('종목코드','종류','계정'),.SDcols=5]
data
names(fs)<-names(data)
data<-rbind(data,fs)
data
corpData
corpData[data]
data[corpData]
data[corpData,by=종목코드]
data[corpData,on=종목코드]
data[corpData,on='종목코드']
corpData[data,on='종목코드']
data
data[,일자:=corpData[[1]]]
data
data
data<-select(data)
select
subset
subset(data,select=c(5,1,2,3,4))
corpData
corpData[,1]
corpData[,1][[1]]
corpData[[1]]
=======
fsY[종목코드==code]$등록일자<-yDate-1
fsQ[종목코드==code]$등록일자<-qDate-1
}
source('~/Github/StockTradebot/Rscript/RQuantFunctionList.R', encoding = 'UTF-8')
fsQ
i
businessDate<-as.Date(corpTable[i,][[1]],format='%Y-%m-%d')
code<-corpTable[i,][[2]]
yData<-fsY
qData<-fsQ
yData$일자<-as.character(yData$일자)
qData$일자<-as.character(qData$일자)
yDate<-as.Date(paste0(yData$일자,'.01'),format='%Y.%m.%d')
qDate<-as.Date(paste0(qData$일자,'.01'),format='%Y.%m.%d')
yDate
qDate
fsY
fsY$등록일자<-as.Date(paste0(fsY$일자,'.01'),format='%Y.%m.%d')
fsY
fsQ$등록일자<-as.Date(paste0(fsQ$일자,'.01'),format='%Y.%m.%d')
fsQ
fsY[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
fsQ[fsY,on="일자"]
fsQ[fsY,on=종목코드,종류,계정,일자]
fsQ[fsY,on=c(종목코드,종류,계정,일자)]
fsQ[fsY,on=c("종목코드","종류","계정","일자")]
fsQ[fsY,on=c("종목코드","종류","계정","일자")]$일자
unique(fsQ[fsY,on=c("종목코드","종류","계정","일자")]$일자)
fsQ[fsY,on=c("종목코드","종류","계정","일자")]$일자
fsQ[fsY,on=c("종목코드","종류","계정","일자")]
fsQ[종목코드=='033780' & 종류=='포괄손익계산서' & 일자=='2017.12']
fsQ[종목코드=='033780' & 일자=='2017.12']
fsQ[종목코드=='033780']
fsQ[종목코드=='033780' & 종류=='포괄손익계산서' & 계정=='기타대손상각비 ']
fsQ[종목코드=='033780' & 종류=='포괄손익계산서' & 계정=='기타대손상각비']
fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
unqiue(fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]$일자)
unique(fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]$일자)
month(fsY[,등록일자])<-month(fsY[,등록일자])+4
fsY
setDT(fsY)
month(fsY[,등록일자])<-month(fsY[,등록일자])+4
month(fsQ[,등록일자])<-month(fsQ[,등록일자])+3
fsY[,등록일자]
month(fsY[,등록일자])
month(fsY[,등록일자])+4
month(fsY[,등록일자])<-month(fsY[,등록일자])+4
library(lubridate)
month(fsY[,등록일자])<-month(fsY[,등록일자])+4
fsY
fsY[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
month(fsY[,등록일자])<-month(fsY[,등록일자])+4
month(fsY[,등록일자])
fsY
fsY$등록일자
month(fsY$등록일자)<-month(fsY$등록일자)+4
fsY
month(fsQ$등록일자)<-month(fsQ$등록일자)+3
joinedQ<-fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
fsY[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsY
month(fsY$등록일자)<-month(fsY$등록일자)+4
month(fsQ$등록일자)<-month(fsQ$등록일자)+3
joinedQ<-fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ<-fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
?setdiff
?setintersect
fintersect(fsQ,joinedQ)
joinedQ
fsQ
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsQ
month(fsY$등록일자)<-month(fsY$등록일자)+4
month(fsQ$등록일자)<-month(fsQ$등록일자)+3
fsQ
month(fsQ$등록일자)+3
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsQ
d<-fsQ[1759292,]
d
month(d$등록일자)<-month(d$등록일자)+3
d
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
d<-fsQ[1759292,]
d
month(d$등록일자)
month(d$등록일자)+3
a<-d$등록일자
ㅁ
a
month(a)<-month(a)+3
a
a
a<-d$등록일자
a
a$month
a %m+% 3
a
ymd(a)
?ymd
a %m+% months(3)
month(a)<-month(a)+months(3)
a
fsY$등록일자<-fsY$등록일자 %m+% months(3)
fsY[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')-1]
fsY$등록일자<-fsY$등록일자 %m+% months(4)
fsQ$등록일자<-fsQ$등록일자 %m+% months(3)
fsQ
fsY
fsY[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
fsY$등록일자<-fsY$등록일자 %m+% months(4)-1
fsQ$등록일자<-fsQ$등록일자 %m+% months(3)-1
fsY
fsQ
joinedQ<-fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
?merge
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,i.등록일자자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,i.등록일자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,등록일자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,등록일자=i.등록일자자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,등록일자=i.등록일자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
joinedQ<-fsQ[fsY,on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
fsQ<-rbind(fsQ,joinedQ)
fsQ
joinedQ
joinedQ<-fsQ[fsY,.(종목코드,종류,계정,일자,값,등록일자=i.등록일자),on=c("종목코드","종류","계정","일자"),nomatch=0]
fsQ<-rbind(fsQ,joinedQ)
joinedQ
fsQ
joinedQ
joinedQ$종목코드
unique(joinedQ$종목코드)
joineQ
joinedQ
fsQ<-rbind(fsQ,joinedQ)
fsQ<-rbindlist(fsQ,joinedQ)
fsQ<-rbind(fsQ,joinedQ)
joinedQ[is.null(종목코드)]
joinedQ[!is.null(종목코드)]
rbind(fsQ,joinedQ,fill=TRUE)
setDT(joinedQ)
rbind(fsQ,joinedQ)
names(joinedQ)<-names(fsQ)
rbind(fsQ,joinedQ)
unique(rbind(fsQ,joinedQ),fromLast=TRUE)
unique(rbind(fsQ,joinedQ),by=c("종목코드","종류","계정","일자"),fromLast=TRUE)
unique(rbind(fsQ,joinedQ),by=c("종목코드","종류","계정","일자","값"),fromLast=TRUE)
max(fsQ$등록일자)
Sys.Date()
Sys.Date()
fsQ
fsY
dbWriteTable(conn,SQL("test.분기재무제표"),fsQ,overwrite=TRUE,row.names=FALSE)
dbWriteTable(conn,SQL("test.분기재무제표"),fsQ,overwrite=TRUE,row.names=FALSE,encoding='UTF-8')
dbWriteTable(conn,"test.분기재무제표",fsQ,overwrite=TRUE,row.names=FALSE)
Encoding(fsQ)
Encoding(fsQ$title)
Encoding(fsQ$종목코드)
foreach(var col in fsQ) print(col)
foreach(col in fsQ) print(col)
for(col in fsQ) print(col)
for(i in length(names(fsQ)) print(i)
fsQ[[i]]
fsQ[[1]]
for(i in 1:length(names(fsQ)) print(i)
for(i in 1:length(names(fsQ))) print(i)
for(i in 1:length(names(fsQ))) Encoding(fsQ[[i]])<-"UTF-8"
for (name in colnames(raw[,sapply(fsQ, is.character), with=F])){
Encoding(fsQ[[name]]) <- "UTF-8"}
for (name in colnames(fsQ[,sapply(fsQ, is.character), with=F])){
Encoding(fsQ[[name]]) <- "UTF-8"}
dbWriteTable(conn,SQL("test.분기재무제표"),fsQ,overwrite=TRUE,row.names=FALSE)
fsQ
fsetdiff(joinedQ,fsQ)
fsQ
joinedQ
fsQ
fintersect(fsQ,joinedQ)
fsQ[fsY,.(종목코드,종류,계정,일자,값,등록일자=i.등록일자),on=c("종목코드","종류","계정","일자"),nomatch=0]
joinedQ
fsQ<-unique(rbind(fsQ,joinedQ),by=c("종목코드","종류","계정","일자","값"),fromLast=TRUE)
fintersect(fsQ,joinedQ)
fdiff(fsQ,joinedQ)
?fintersect
fsetdiff(joinedQ,fsQ)
fsQ[,등록일자:=as.Date(paste0(일자,'.01'),format='%Y.%m.%d')]
fsetdiff(joinedQ,fsQ)
fsetdiff(joinedQ,fsQ,by=c('종목코드','종류','계정','일자','값'))
fsetdiff(joinedQ[,-등록일자],fsQ[,-등록일자],by=c('종목코드','종류','계정','일자','값'))
fsetdiff(joinedQ[,-등록일자],fsQ[,-등록일자])
fsetdiff(joinedQ[-등록일자],fsQ[-등록일자])
fsQ[,-등록일자]
fsQ[,-'등록일자']
fsetdiff(joinedQ[-'등록일자'],fsQ[-'등록일자'])
fsetdiff(joinedQ[,-'등록일자'],fsQ[,-'등록일자'])
fsetdiff(fsQ[,-'등록일자'],joinedQ[,-'등록일자'])
>>>>>>> 2f9028dea9ca8e7a59708c72362670b782dd80c0
sumQuarterData<-function(data){
fs<-data[data$종류=='재무상태표']
data<-data[data$종류!='재무상태표']
fs<-fs[fs$일자==max(fs$일자)]
fs<-fs[,-'일자']
if(length(unique(data$일자))>1) data<-data[,.(값=sum(값)),by=c('종목코드','종류','계정','등록일자')] else{
data<-data[,-'일자']
}
names(fs)<-names(data)
data<-rbind(data,fs)
return(data)
}
fs<-list()
?append
set(1:79654,by=1000)
seq(1:79654,by=1000)
seq(1,79654,by=1000)
35
4:6
